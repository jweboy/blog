---
title: 组件开发
---

本文档从实际应用角度出发阐述一个组件的开发、发布过程，具体的组件编写规范请参照 [项目规范](http://www.baidu.com)。

## 组件开发

### 安装依赖

在开始项目之前，首先需要安装项目依赖，执行 `install` 命令（`install`命令可以简写为`i`）。

```
npm i
```

### 链接全局

当依赖安装完成之后，需要将项目目录链接到全局，执行 `link` 命令。

```
npm link
```

`link` 命令完成后默认会在全局 `node_modules` 中创建一个`副本项目`（这是`当前项目的拷贝`，且`实时同步更新`），同时会将 [package.json](http://www.baidu.com) 指定的 `name` 挂载到全局，此时的组件库就是一个`全局模块`，在其他项目中 [引入名称](http://www.baidu.com) 即可使用。全局目录如下图：

> link 之后的目录是一个软链接（即文件符号链接），和普通的目录有所区别。

### 运行脚本

当目录链接完成之后，就可以执行开发脚本来运行项目了，执行 `build:watch` 命令（该命令默认`监听文件改动自动编译源码文件`）。

```
npm run build:watch
```

执行完此命令后，默认会生成 `es` 和 `lib` 两个目录的编译文件。其中 `es` 目录是 `ESModule` 语法， `lib` 目录是 `commonjs` 语法，分别指定在 [package.json](http://www.baidu.com) 中的 `main` 和 `module` 字段中，便于其他项目的按需使用。

## 调试组件

### 链接组件

在需要应用组件库的项目中执行 `link [组件库名]` 命令（`link` 的名称对应 [package.json](http://www.baidu.com) 的 `name` 字段值，即上面创建的 `全局模块`），执行完成后会在项目的 `node_modules` 中生成组件库目录的副本（类似上面的 `npm link` 命令，且`实时同步更新`），如果本地已存在组件目录默认会覆盖。在 `umi3` 新项目中 `link` 完之后会自动重启服务，老项目需要手动停止再重新运行服务。

```
npm link stu
```

## 发布组件

在发布组件时，需要先执行 `login` 命令登录自己的`npm`账户，该账户在 [npm 仓库](http://www.baidu.com) 自行注册。登录完成后，再执行 `publish` 命令就会进入发布流程，默认在发布之前会执行 `update:version` 和 `build` 命令，全部完成之后才会将组件库发布到[npm 仓库](http://www.baidu.com)。如果在这个过程中出现 `npm` 的 `403` 的错误，一般是由于当前 `npm` 账户未登录引起的，登录账号后重试即可。

### 命令说明

首先会执行 `update:version` 命令，此命令有三个选项 `主版本号(major)`、`次版本号(minor)`、`修订号(patch)`，遵循以下几点：

- 组件库整体改版或版本大改动采用 `major`
- 新增组件、优化组件采用 `minor`
- 修复组件 `bug` 采用 `patch`

其次会执行 `build` 命令，默认编译 `src` 目录下的所有代码文件，并输出到 `es` 和 `lib` 这两个目录。

执行完成后就会默认执行 `npm` 自身的 `publish` 功能来上传组件库。

## 取消发布

如果需要重新发布版本可执行 `unpublish` 命令来取消已发布的最新版本，同时需要带上 `force` 参数。

```
npm unpublish --force
```
